---
description: Feature development workflow for AI agents - three phases, task tracking, and completion signals
globs:
  - "specs/**/*"
  - "src/**/*"
  - "app/**/*"
alwaysApply: false
---

# Feature Development Workflow

> **Template**: Copy to `.cursor/rules/feature-workflow.mdc`
> This rule activates when working in specs/ or source code directories.
> **Alternative**: This can also be a portable skill at `.agents/skills/feature-workflow/SKILL.md`

## Three Phases

```
Research → Plan → Implement
(optional)  (required)  (required)
```

## Decision Tree

```
Is this a bug fix?
├─ YES → Just fix it (no docs needed)
└─ NO → Create specs/[feature]/spec.md + tasks.md

    Do I need to evaluate options?
    ├─ YES → Add research.md (Research phase)
    └─ NO → Continue to Plan

    Validate with user → Implement
```

---

## Context Loading Order

Load files in this order before implementation:

1. `AGENTS.md` - Project overview, tech stack, patterns
2. `specs/[feature]/spec.md` - Requirements
3. `specs/[feature]/tasks.md` - Current task status
4. `specs/[feature]/research.md` - Research notes (if exists)
5. Relevant skills or `.cursor/rules/*.mdc` - Coding patterns

---

## Before Starting Work

```
AI MUST check before implementing:

1. Does specs/[feature]/spec.md exist?
   ├─ YES → Read it, proceed to step 2
   └─ NO → Create spec.md with acceptance criteria
          ASK USER to validate before implementing

2. Does specs/[feature]/tasks.md exist?
   ├─ YES → Find first task not [x], [S], or [B]
   └─ NO → Create tasks.md from spec requirements

3. Is there already a task marked [~]?
   ├─ YES → Continue that task OR ask if switching
   └─ NO → Mark next pending task [~]
```

---

## Task Markers

| Marker | Status |
|--------|--------|
| `[ ]` | Pending |
| `[~]` | In progress (only ONE) |
| `[x]` | Completed |
| `[B]` | Blocked (include reason) |
| `[S]` | Skipped (include reason) |

---

## During Implementation

```
AI MUST follow these rules:

1. ONE task [~] at a time
   - Never have multiple tasks in progress

2. Update tasks.md after EACH task
   - Mark completed: [x]
   - Mark blocked: [B] with reason
   - Mark skipped: [S] with reason
   - Recalculate progress

3. Progress calculation
   progress = (completed + skipped) / total * 100

4. When blocked
   - Mark task [B] with clear reason
   - Ask user for guidance
```

---

## Signaling Completion

When all tasks are `[x]` or `[S]`:

```
"Ready for review. Implementation complete.

**DoD Checklist**:
- [x] All tasks completed (X/Y)
- [x] Acceptance criteria verified
- [ ] Human review needed

**Acceptance Criteria Status**:
- AC-01: ✓ Implemented
- AC-02: ✓ Implemented

**Next steps**: Please review and provide feedback."
```

For complex features, also include:
- ADR needed: Yes/No
- AGENTS.md updates needed: [List sections]

---

## After Approval

1. **Update docs/** (if code changes affect schema, API, auth, or architecture)
2. **Create ADR** (if significant decision was made)
3. **Update AGENTS.md** (if new patterns)
4. **Delete spec folder**: `specs/[feature]/`

---

## When to Create ADR

Create an ADR in `docs/decisions/` when ANY of these are true:

- Evaluated 2+ alternatives and chose one
- Introduced a new architectural pattern
- Made a breaking change
- Chose a third-party library/service

---

## Templates Reference

Templates location: `.acdl/templates/`

| Template | Required | Copy To |
|----------|----------|---------|
| `spec.md` | Yes | `specs/[feature]/spec.md` |
| `tasks.md` | Yes | `specs/[feature]/tasks.md` |
| `research.md` | No | `specs/[feature]/research.md` |
| `design.md` | No | `specs/[feature]/design.md` |
| `plan.md` | No | `specs/[feature]/plan.md` |
| `user-stories.md` | No | `specs/[feature]/user-stories.md` |
| `adr.md` | No | `docs/decisions/NNN-[title].md` |

Quick reference: `.acdl/README.md`
